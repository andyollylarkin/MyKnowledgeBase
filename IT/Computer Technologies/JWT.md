---
aliases: [Json Web Token, JW Token, JWT Token, JWT авторизация]
tags: [crypto, authentication, basis, cs, security]
---
# JWT
<h6>25-09-2022</h6>
----------
## Определение
Метод авторизации на основе **Json Web Token**.

## Зачем?
![[Pasted image 20220925232158.png]]

0. Клиент обращается на сервер
1. Сервер генерирует его и отправляет в [[Cookie]]
> Для установки cookie сервер передает HTTP параметр Set-Cookie ([см. MDN](https://developer.mozilla.org/ru/docs/Web/HTTP/Cookies))

2. Далее клиент общается с сервером идентифицируя себя с помощью ID который выдал сервер

Далее в нашем сервиса появились другие сервисы (микросервисы, т.е. отдельные от нашего текущего приложения сервисы), или внешняя авторизация.

Допустим у нас есть сервер авторизации и сервер бизнес логики:
![[Pasted image 20220925232949.png]]
0. Клиент регистрируется на сервере
1. В ответ клиент некоторый id в системе
2. Клиент идет на сервер БЛ

Далее есть 2 проблемы:
1. **Cookie** устанавливается для определенного домена (поле <u>Domain</u> в <u>Set-Cookie</u>)
2. Серверу БЛ ничего не говорит наш ID, т.к. эта информация о нас которую мы можем получить по данному ID находится в "хранилище" сервера *Auth* и чтобы получить данные по этому ID нам нужно сходить из сервера *Domain Logic*. 

## Решение с помощью JWT
Решением может послужить JWT Token.
JWT токен имеет следующую структуру:

1. **HEADER**
2. **PAYLOAD**
3. **SIGNATURE**

*Сигнатура* это [[base64]] закодированные *заголовок* и *payload*, которые подписаны **секретным ключем** хранящимся на сервере.

Этот секретный ключ "расшарен" между сервером *Auth* и *Domain Logic*.
> По хорошему такой секрет нужно хранить и получать из хранилищ секретов, например HashiCorp Vault

Таким образом клиент:
1. Аутентифицируется на сервере *Auth* и получает в ответ <u>Access Token</u>
2. Идет с этим токеном на *Domain Logic*
3. Т.к. на сервере *Domain Logic* мы знаем ключ которым подписывался токен, мы можем его расшифровать и быть уверены, что клиент валиден.

> <span style="color: red">По сути разделение секретного ключа между серверами и есть тот принцип по которому мы можем ходить и расшифровывать сообщения между серверами.</span>


---
## Библиография
- [Про JWT](https://gist.github.com/zmts/802dc9c3510d79fd40f9dc38a12bccfc)
- [JWT Introduction](https://jwt.io/introduction)
