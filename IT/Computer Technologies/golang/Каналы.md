---
aliases: [chan, go channels, go каналы]
tags: [go, gonang, basis]
---
# Каналы
<h6>24-09-2022</h6>
----------
## Определение
Канал похож на [[Unix Pipe]]. Каналы предназначены для коммуникации между [[Горутина|горутинами]] , принимая и отправляя в них значения. 

> Каналы имеют ссылочный тип и по умолчанию их значение = _nil_

## Обьявление типа
*ChannelType = ( "chan" | "chan" "<-" | "<-" "chan" ) ElementType*
Где:
- *chan <-* - только принимающий канал,
- <- chan - только отправляющий канал
- chan - принимающий и записывающий
- ElementType - тип элемента который будет записан в канал

## Инициализация канала
```go
make(chan int, 100) // где chan int - тип канала, 100 вместимость канала
```

## Закрытие канала
Закрыть канал можно встроенной функцией - *close()*


## Каналы и дедлок
><span style="color:red">fatal error: all goroutines
are asleep — deadlock!</span>

Такое сообщение об ошибке можно увидеть, когда две [[Горутина|горутины]] взаимодействуют с одним каналом. Если первая [[горутина]] будет читать из канала, в котором будет пусто, то процесс переключится на другую горутину, которая уже возможно ничего не пишет в канал, или вообще закончила свое исполнение, следовательно первая [[горутина]] окажется **вечно заблокированной**, это называется **[deadlock](https://ru.wikipedia.org/wiki/%D0%92%D0%B7%D0%B0%D0%B8%D0%BC%D0%BD%D0%B0%D1%8F_%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B0)**.
![[Pasted image 20220924181944.png]]

#### Пример
```go
package main  
  
import (  
   "sync"  
)  
  
func main() {  
   var wg sync.WaitGroup  
   ch := make(chan int)  
   wg.Add(1)  
   go func() {  
      ch <- 1 // тут произойдет блокировка и собственно дедлок, потому что никто не будет читать из канала
   }()  
  
   wg.Wait()  // Ждем выполнения анонимной горутины выше, иначе программы завершится быстрее чем мы увидим сообщение об ошибке
}
```


### Пример deadlock в одной и той же горутине

```go
package main  
  
func main() {  
   var ch chan int  
   ch = make(chan int)  
   ch <- 1  
   println(<-ch)  
}
```

Этот код приведет к следующей ошибке:
><span style="color:red">fatal error: all goroutines
are asleep — deadlock!</span>

Дело в том, что оба оператора как чтения так и записи в канал блокируют горутину пока принимающая сторона не получит значение. В данном случае блокировка будет тут:
```go
ch <- 1  
```
Единица запишется в канал, после чего горутина заблокируется. А т.к. и чтение и запись происходят в одной горутине, то произойдет взаимоблокировка (deadlock).


---
## Библиография
- 
