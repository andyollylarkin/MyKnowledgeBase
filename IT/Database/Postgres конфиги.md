---
aliases: [postgres config, постгрес конфиг, постгрес конфиги, postgresql.conf, pg_hba.conf]
tags: [db, postgres, configuration, config, pg, postgresql, database]
---
# Postgres конфиги
<h6>08-03-2022</h6>
----------
## Определение
Конфигурационные файла [[СУБД]] **PostgreSQL**


## Описание

## Список конфигурационных файлов
### postgresql.conf 
Основной конфиг. Расположение по умолчанию - каталог определенный в **PGDATA**. Пакетные дистрибутивы распологают данный файл в другом месте в зависимости от правил принятых в конкретном дистре.
>Для вступления в силу внесенных в файл изменений, необходимо, чтобы сервер перечитал файл. Для некоторых параметров требуется перезагрузка сервера.
### postgresql.auto.conf
Этот файл не следует изменять вручную. Для его редактирования предназначена команда ALTER SYSTEM. По сути ALTER SYSTEM представляет собой [[SQL]]-интерфейс для удаленного управления параметрами конфигурации. Для применения изменений, сделанных ALTER SYSTEM, сервер должен перечитать конфигурационные файлы, как и в случае с postgresql.conf.

### pg_hba.conf
> hba - host based authentication

Записи в этой файле просматриваются сверху вниз до первого совпадения. Если произошло совпадение, то производятся действия: проверка параметров. Если всё прошло успешно происходит логин, иначе reject. Другие совпадения далее не ищутся.
> Если ни одна запись не подошла - доступ запрещается

Поля конфиг. файла:
- тип подключения
- имя базы данных
- имя пользователя
- адрес узла
- метод аутентификации
- необязательные доп. параметры в виде *key=value*

#### Тип подключения
- local - локальное подключение через UNIX-Domain сокет
- host - TCP/IP
- hostssl - шифрованный TCP/IP
- hostnossl - не шифрованный TCP/IP

#### Имя базы данных
- all - любая БД
- sameuser - БД у которой совпадает имя с именем подключающегося юзера.
- samerole - БД у которой совпадает имя или роль с именем подключающегося юзера.
- имя БД - явно указанное имя БД
- имя\[,имя\] - множество баз через запятую


#### Адрес узла
 - all - любой IP
 - ip/CIDR - пул адресов в CIDR нотации
 - samehost - IP адрес сервера
 - samenet - любой IP из текущей подсети
 - domain_name - IP соотв. доменному имени
 > адрес можно указать доменным именем (или частью доменного имени, начиная с точки). PostgreSQL определит принадлежность IP-адреса клиента указанному домену: для этого сначала по IP-адресу определяется доменное имя (reverse lookup), а затем проверяется, что такому домену действительно соответствует исходный IP-адрес (forward lookup). Таким образом проверяется соответствие владельца сети и владельца доменного имени для отсечения скомпрометированных адресов (см. https://en.wikipedia.org/wiki/Forward-confirmed_reverse_DNS).

### Виды аутентификации
- trust - допустить без аутентификации
- reject - запретить без аутентификации
- Пароль:
  1. md5 - md5 шифрованный пароль
  2. scram-sha-256 - [[SCRAM протокол]]
  3. ldap \[параметры\]- пароль хранится на сервере [[LDAP]]
  4. radius \[параметры\] - пароль хранится на сервере [[RADIUS]]
  5. pam \[параметры\] - пароль хранится в подключаемом модуле [[PAM]]
---
**Вне [[СУБД]]**
- peer \[map=\] - запрос имени пользователя у ядра ОС (для локальных подключений)
- cert \[map=\] - аутентификация с использованием клиентского [[SSL-TLS|SSL]]
- gss \[map=\] - аутентификация [[Kerberos]] по протоколу [[GSSAPI]]
- sspi \[map=\] - аутентификация Kerberos/NTLM для Windows 

## Установка пароля
- Переменная окружения $PGPASSWORD - **не рекомендуется из соображений безопасности**
- файл ~/.pgpass - пароли в профиле пользователя в формате: *host:db:user_name:password*
> файл должен иметь [[Права доступа в Linux|разрешение]] 600

## Соответствие имен
- **pg_ident.conf** - Правила сопоставления имен определяются в отдельном файле pg_ident.conf; его расположение определяется параметров ident_file. Файл имеет такую же структуру, как и pg_hba.conf. Записи состоят из трех полей: название соответствия, внешнее имя, внутреннее имя. Название соответствия необходимо, чтобы разграничивать разные правила сопоставления внутри одного файла pg_ident.conf (которые могут потребоваться для разных записей в pg_hba.conf). Внешнее имя должно совпадать с именем, возвращаемым внешней системой аутентификации или указанным в сертификате. *Если это поле начинается с косой черты, то его значение считается регулярным выражением*. Это позволяет обработать ситуации, когда внешнее и внутреннее имена отличаются только префиксами или суффиксами. Внутреннее имя должно совпадать с именем пользователя базы данных. Запись, сопоставляющая внутреннее и внешнее имена, означает, что данному внешнему пользователю разрешено подключаться к [[СУБД]] под данным внутренним пользователем (конечно, при условии успешной аутентификации).
---
## Библиография
- [Курс от PostgresPro](https://postgrespro.ru/education/courses/DBA1)
