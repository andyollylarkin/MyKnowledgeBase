---
aliases: [redirection, fire descriptor redirection, перенаправление ввода вывода]
tags: [linux, pipe, redirection, concept,conception,bash]
---
<h6>10-09-2022</h6>
----------
## Определение
Перенаправление файловых дескрипторов это механизм [[Оболочка|оболочки]] который может перенаправить информацию из одного файлового дескриптора в другой

> Можно найти открытые процессом дескрипторы в файловой системе *proc*
> **/proc/pid/fd**

### Стандартные дескрипторы
По умолчанию каждый процесс в Linux имеет 3 файловых дескриптора

|Номер|Значение|Примечание|
|---|---|---|
|0|Ввод|Стандартный дескриптор ввода. Можно ссылаться переменной *stdin*|
|1|Вывод|Стандартный дескриптор вывода. Можно ссылаться переменной *stdout|
|2|Ошибка|Стандартный дескриптор ошибки. Можно ссылаться переменной *stderr|
|3-9|Остальные|При открытии файлов эти дескриптор не выделяются, т.к. зарезервированы. Но можно открыть вручную|
|10-...|Остальные| дескриптор выше 10 выделяются для открываемых файлов|

> Имена stdin,stdout,stderr определены в файле unistd.h


## Синтаксис перенаправления
> \[command\] {params} {n{>|<|>&|<&} \[other\]} {file}

## Почему возможно перенаправление
> ./myscript 2>&1

Перенаправление работает так: процесс создает [[Всё есть файл|дескриптор]] файла 2 дубликат дескриптора файла 1, так что он ссылается на тот же [[Всё есть файл|дескриптор]] куда ссылается файловый [[Всё есть файл|дескриптор]] 1. Дублирование происходит с помощью [[Системный вызов|системного вызова]] **dup(int *oldfd*)**

Пример:
![[Pasted image 20220910191247.png]]
![[Pasted image 20220910191223.png]]

> Если не открыть файловый дескриптор перед перенаправлением, то получим ошибку c кодом 130 - **Bad file descriptor**


## Наглядная схема происходящего
![[Pasted image 20220910200931.png]]

## Открытие дескриптора с помощью builtin exec
**exec** не запускает новую оболочку, а замещает текущую новой командой. Если вместо команды указать открытие нового файлового дескриптора, то он откроется и будет доступен в текущем процессе оболочки.


---
## Библиография
- man bash - REDIRECTIONS
- [Хороший пример где рассказывается построчно работа перенаправлений](https://askubuntu.com/questions/491509/how-to-get-dialog-box-input-directed-to-a-variable)
