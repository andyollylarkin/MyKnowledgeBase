---
aliases: [kafka basic, kafka broker, kafka basis, partitions, apache kafka]
tags: [amqp, basis, foundation, kafka, apache_kafka]
---
<h6>02-03-2023</h6>
----------

![[Pasted image 20230302145010.png]]

## Из каких элементов состоит Kafka
1. Producers - производители сообщений
2. Brokers - брокеры сообщений
3. Consumers - потребители сообщений

Брокер в свою очередь состоит из:
1. Topic - очередь куда помещаются сообщения
2. Partition - партиция топика для распределения нагрузки
3. Consumer group - группа потребителей одного топика
4. Offset - смещение для каждой группы

## Как распределяется запись в топики при > 1 топике
Producer пишет в топик в определенную партицию. Распределение идет по принципу round-robin.

## Зачем нужны партиции
При одной партиции и > 1 потребителя только один потребитель из группы сможет получать сообщения. Для масштабирования очереди нужно создать несколько партиций в одном топике. Общий принцип таков, что *count_partitions = count_consumers*. Если партиций меньше чем потребителей, то потребители на которых не выделены партиции будут простаивать.

## Что такое offset
![[Pasted image 20230302150002.png]]
Структура записей в Kafka (в рамках одного топика) состоит из последовательного лога событий. При подключении к топику группы для каждой группы указывается смещение (offset) относительно уже прочитанных сообщений. Каждая группа потребителей имеет свой offset. Смещение нужны в том случае, если потребитель отключился от брокера, а затем снова подключился, чтобы в этом случае потребитель не вычитывал заново все записи из партиции. Чтение начнется с указанного в брокере смещения для группы. 

---
## Библиография
- [Kafka на практике](https://www.youtube.com/watch?v=Ep9ZQjrn1Rs)
